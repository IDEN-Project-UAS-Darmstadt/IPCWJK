% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/deltamethod_pred_function.R
\name{deltamethod_pred_function}
\alias{deltamethod_pred_function}
\title{Apply the delta method based on a prediction formula}
\usage{
deltamethod_pred_function(
  prediction_str,
  coefs,
  coef_cov,
  additional_coefs = character(),
  fixed_vars = list(),
  logit = FALSE
)
}
\arguments{
\item{prediction_str}{Character. A string specifying the prediction formula,
which must contain one occurrence of \code{"LP"} to be replaced by
the linear predictor constructed from the coefficients and covariate
values.}

\item{coefs}{Named numeric vector. The estimated coefficients from the fitted
model. The names must correspond to the covariate names used in the model.}

\item{coef_cov}{Square numeric matrix. The covariance matrix of the estimated
coefficients. The row and column names must match the names of
\code{coefs}.}

\item{additional_coefs}{Character vector. Names of coefficients in
\code{coefs} that are not part of the linear predictor but are required in
the prediction formula (default is an empty character vector).}

\item{fixed_vars}{List. Named list of fixed values for variables used in the
prediction formula but not present in the new data (default is an empty
list).}

\item{logit}{Logical. If \code{TRUE}, the delta method is used on the
logit scale. This ensures CIs are between 0 and 1 (default is
\code{TRUE}).}
}
\value{
A function that takes a data frame of covariates and returns a
data frame with columns for the prediction, lower and upper Wald
confidence intervals, and standard error. The function can also take
an optional argument \code{z} for the z-score used in confidence
interval calculation (default is 1.96 for 95\% CI).
}
\description{
\loadmathjax
Constructs a prediction function that computes model predictions and
their standard errors and Wald confidence interval using the delta method
for a user-specified prediction formula.
}
\details{
This function is intended for use with fitted
regression models, including those for survival analysis, and allows
flexible specification of the linear predictor, additional coefficients,
and fixed covariate values. The resulting function can be applied to
new data to obtain both predictions and delta method-based standard
errors.

This function is used internally in the package to provide
delta method-based standard errors for as a comparison.

For a prediction function
\mjeqn{g(\theta)}{g(theta)}, the standard error is approximated as
\mjdeqn{\sqrt{\nabla g(\theta)^\top \Sigma \nabla g(\theta)}}{
sqrt(grad g(theta)^T Sigma grad g(theta))}
where \mjeqn{\Sigma}{Sigma} is the covariance matrix of the estimated
coefficients.

The input \code{prediction_str} must contain one occurrence of
\code{"LP"}, which will be replaced by the linear predictor constructed
from the provided coefficients and covariate values.
}
\examples{
coefs <- c("(Intercept)" = 0.5, "age" = 0.1, "sex" = -0.2)
coef_cov <- diag(c(0.01, 0.0025, 0.0025))
rownames(coef_cov) <- colnames(coef_cov) <- names(coefs)
pred_fun <- deltamethod_pred_function(
  prediction_str = "1 / (1 + exp(-(LP)))",
  coefs = coefs,
  coef_cov = coef_cov
)
newdata <- data.frame(age = c(50, 60), sex = c(1, 0))
pred_fun(newdata)
}
\references{
\insertAllCited{}
}
\seealso{
Other helpers: 
\code{\link{deltamethod_from_model}()},
\code{\link{ipcw_weights}()}
}
\concept{helpers}
